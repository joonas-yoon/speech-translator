'use strict';const viewer=document.getElementById("spchtrs-viewer"),threadContainer=viewer.querySelector("#spchtrs-threads");function getRandomHash(){return Math.random().toString(36).substring(2,12)}function createText(text){const t=document.createElement("span");return t.classList.add("text-bg"),t.innerHTML=text,t}function setText(id,text){const t=document.getElementById(id);if(!t)return!1;const wrapper=t.querySelector(".text > span");return wrapper.innerHTML=text,!0}function addTextItem(text,subtext){const item=document.createElement("div");item.classList.add("item"),item.id=getRandomHash();const textCont=document.createElement("div");textCont.classList.add("text"),text&&textCont.appendChild(createText(text)),item.appendChild(textCont);const subTextCont=document.createElement("div");subTextCont.classList.add("sub-text"),subtext&&subTextCont.appendChild(createText(subtext)),item.appendChild(subTextCont),threadContainer.appendChild(item);const $threads=$(threadContainer),counts=$threads.find(".item").length;return 5<=counts&&threadContainer.removeChild(threadContainer.firstChild),new Promise(function(resolve){resolve({itemId:item.id,text:subtext})})}async function appendResult(results,sendResponse){if(!results||!results.length)return;const transcripts=[];for(const result of results){const alternatives=result.alternatives||[];for(const alter of alternatives){const text=alter.transcript||"",confidence=alter.confidence||0,confidenceHumanized=Math.round(100*(100*confidence))/100;await addTextItem("&#8230;",text).then(item=>{item.confidence=confidenceHumanized,transcripts.push(item)})}}sendResponse(transcripts)}function visualize(percentage){const footerContainer=viewer.querySelector(".spchtrs-footer"),bar=footerContainer.querySelector(".volumebar");bar.style.width=50*percentage+"%"}function hideViewer(){$(viewer).fadeOut(),chrome.runtime.sendMessage({msg:"stop"})}function showViewer(){$(viewer).fadeIn(),chrome.runtime.sendMessage({msg:"start"})}(function ping(){chrome.runtime.onMessage.addListener(function(msg,sender,sendResponse){return chrome.runtime.lastError?void setTimeout(ping,100):void("showViewer"===msg.method?showViewer():"hideViewer"===msg.method?hideViewer():"visualize"===msg.method?visualize(msg.avgDecibel):"recognize"===msg.method?appendResult(msg.results,sendResponse):"message"===msg.method&&!setText(msg.itemId,msg.text)&&addTextItem("&#8230;",msg.text))})})(),chrome.runtime.sendMessage({msg:"display"},function(isDisplayed){isDisplayed?showViewer():hideViewer()});function dragElement(elmnt){function dragMouseDown(e){e=e||window.event,e.preventDefault(),pos3=e.clientX,pos4=e.clientY,oldmouseup===void 0&&(oldmouseup=document.onmouseup),oldmousemove===void 0&&(oldmousemove=document.onmousemove),document.onmouseup=closeDragElement,document.onmousemove=elementDrag,elmnt.dragged=!0}function elementDrag(e){e=e||window.event,e.preventDefault(),pos1=pos3-e.clientX,pos2=pos4-e.clientY,pos3=e.clientX,pos4=e.clientY,elmnt.style.top=elmnt.offsetTop-pos2+"px",elmnt.style.left=elmnt.offsetLeft-pos1+"px"}function closeDragElement(){document.onmouseup=oldmouseup,document.onmousemove=oldmousemove,oldmouseup=void 0,oldmousemove=void 0}let oldmouseup,oldmousemove,pos1=0,pos2=0,pos3=0,pos4=0;elmnt.onmousedown=dragMouseDown}(function centering(){threadContainer.dragged||(threadContainer.style.left="calc(50% - "+threadContainer.offsetWidth/2+"px)",setTimeout(centering,100))})(),dragElement(threadContainer);