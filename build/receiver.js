'use strict';const viewer=document.getElementById("spchtrs-viewer"),threadContainer=viewer.querySelector("#spchtrs-threads");function getRandomHash(){return Math.random().toString(36).substring(2,12)}function createText(a){const b=document.createElement("span");return b.classList.add("text-bg"),b.innerHTML=a,b}function setText(a,b){const c=document.getElementById(a);if(!c)return!1;const d=c.querySelector(".text > span");return d.innerHTML=b,!0}function addTextItem(a,b){const c=document.createElement("div");c.classList.add("item"),c.id=getRandomHash();const d=document.createElement("div");d.classList.add("text"),a&&d.appendChild(createText(a)),c.appendChild(d);const e=document.createElement("div");e.classList.add("sub-text"),b&&e.appendChild(createText(b)),c.appendChild(e),threadContainer.appendChild(c);const f=$(threadContainer),g=f.find(".item").length;return 5<=g&&threadContainer.removeChild(threadContainer.firstChild),new Promise(function(a){a({itemId:c.id,text:b})})}async function appendResult(a,b){if(!a||!a.length)return;const c=[];for(const d of a){const a=d.alternatives||[];// console.log('[alternatives]', alternatives);
for(const b of a){const a=b.transcript||"",d=b.confidence||0,e=Math.round(100*(100*d))/100;await addTextItem("&#8230;",a).then(a=>{a.confidence=e,c.push(a)})}}b(c)}// visualiser setup - create web audio api context and canvas
function visualize(a){const b=viewer.querySelector(".spchtrs-footer"),c=b.querySelector(".volumebar");c.style.width=50*a+"%"}function hideViewer(){$(viewer).fadeOut(),chrome.runtime.sendMessage({msg:"stop"})}function showViewer(){$(viewer).fadeIn(),chrome.runtime.sendMessage({msg:"start"})}(function a(){// Listen for messages
chrome.runtime.onMessage.addListener(function(b,c,d){return chrome.runtime.lastError?void setTimeout(a,100):void("showViewer"===b.method?showViewer():"hideViewer"===b.method?hideViewer():"visualize"===b.method?visualize(b.avgDecibel):"recognize"===b.method?appendResult(b.results,d):"message"===b.method&&!setText(b.itemId,b.text)&&addTextItem("&#8230;",b.text))})})(),chrome.runtime.sendMessage({msg:"display"},function(a){a?showViewer():hideViewer()});// make element draggable
function dragElement(a){function b(b){// get the mouse cursor position at startup:
// call a function whenever the cursor moves:
b=b||window.event,b.preventDefault(),j=b.clientX,k=b.clientY,f===void 0&&(f=document.onmouseup),g===void 0&&(g=document.onmousemove),document.onmouseup=d,document.onmousemove=c,a.dragged=!0}function c(b){// calculate the new cursor position:
// set the element's new position:
b=b||window.event,b.preventDefault(),h=j-b.clientX,i=k-b.clientY,j=b.clientX,k=b.clientY,a.style.top=a.offsetTop-i+"px",a.style.left=a.offsetLeft-h+"px"}function d(){/* stop moving when mouse button is released:*/document.onmouseup=f,document.onmousemove=g,f=void 0,g=void 0}let f,g,h=0,i=0,j=0,k=0;a.onmousedown=b}// absolutely center positioned
(function a(){threadContainer.dragged||(threadContainer.style.left="calc(50% - "+threadContainer.offsetWidth/2+"px)",setTimeout(a,100))})(),dragElement(threadContainer);