"use strict";const API_URL="http://localhost/api",storage=chrome.storage.local,srcLang=document.getElementById("src-lang"),dstLang=document.getElementById("dst-lang"),srcLangList=srcLang.querySelector(".select-langs"),dstLangList=dstLang.querySelector(".select-langs"),srcLangInput=srcLang.querySelector("input"),dstLangInput=dstLang.querySelector("input");// Store CSS data in the "local" storage area.
function createLangaugeItem(a,b){const c=document.createElement("div");return c.className="lang",c.innerText=b,c.data_code=a,c.addEventListener("click",a=>{const b=a.target.parentElement.parentElement.querySelector("input[type=text]");b.value=c.innerText,b.value_code=c.data_code,b.dispatchEvent(new Event("keyup"))}),c}function onInputChanged(a){const b=a.target,c=b.parentElement.querySelectorAll(".select-langs > .lang"),d=b.value.toLowerCase();c.forEach(function(a){a.innerText.toLowerCase().includes(d)?(a.classList.add("active"),a.classList.remove("inactive")):(a.classList.add("inactive"),a.classList.remove("active"))})}function showLangList(a){const b=a.target.parentElement.querySelector(".select-langs");b.style.display="block"}function hideLangList(a){const b=a.target.parentElement.querySelector(".select-langs");setTimeout(function(){b.style.display="none"},100)}function load(){$.ajax({url:"http://localhost/api/app/translate/supports",data:{},method:"GET",dataType:"json"}).done(function(a){for(let b=0;b<a.length;b++)srcLangList.appendChild(createLangaugeItem(a[b].code,a[b].name)),dstLangList.appendChild(createLangaugeItem(a[b].code,a[b].name));srcLangInput.addEventListener("keyup",onInputChanged),dstLangInput.addEventListener("keyup",onInputChanged),srcLangInput.addEventListener("focus",showLangList),dstLangInput.addEventListener("focus",showLangList),srcLangInput.addEventListener("focusout",hideLangList),dstLangInput.addEventListener("focusout",hideLangList),document.getElementById("btn-save").removeAttribute("disabled")}).fail(function(a,b,c){console.error(a,b,c),addAlertMessage("Server Error","fail",!0)}).always(sync)}// syncronize between forms and storage
function sync(){// get settings or set default
storage.get("options",function(a){const b=a.options||{};b.srcLangName?(srcLangInput.value=b.srcLangName,dstLangInput.value_code=b.dstLangCode):(srcLangInput.value="English",srcLangInput.value_code="en"),b.dstLangCode?(dstLangInput.value=b.dstLangName,dstLangInput.value_code=b.dstLangCode):(dstLangInput.value="Korean",dstLangInput.value_code="ko")})}function save(){const a={};a.srcLangName=srcLangInput.value||"Korean",a.srcLangCode=srcLangInput.value_code||"ko",a.dstLangName=dstLangInput.value||"English",a.dstLangCode=dstLangInput.value_code||"en",storage.set({options:a},function(){addAlertMessage("All saved successfully!","success"),sync()})}function addAlertMessage(a,b,c){const d=document.getElementById("alerts"),e=document.createElement("div");e.className="alert "+(b||""),e.innerHTML=a,d.appendChild(e),c||setTimeout(function(){e.remove()},3e3)}document.addEventListener("DOMContentLoaded",function(){load(),document.getElementById("btn-save").addEventListener("click",function(a){a.preventDefault,a.stopPropagation(),save()}),document.getElementById("btn-close").addEventListener("click",function(a){a.preventDefault,a.stopPropagation(),window.close()})});